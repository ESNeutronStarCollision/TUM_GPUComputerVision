CPPFLAGS = -c
NVCCFLAGS_MAIN = --ptxas-options=-v --use_fast_math --compiler-options -Wall -lopencv_highgui -lopencv_core
NVCCFLAGS_INVERT_IMAGE = --ptxas-options=-v --compiler-options -Wall

# library base directory
LIBDIR = ../../libs

# TODO fix library includes
# includes of libraries
# INCLUDES = -I../../libs/includes
INCLUDES = -I../../libs/global_idx

# compilers
CPP = g++
NVCC = nvcc

################# main
all: lib.o invert_image_CPU.o invert_image.o main.cu aux.cu aux.h Makefile
	$(NVCC) -o main main.cu aux.cu invert_image_CPU.o invert_image.o $(NVCCFLAGS_MAIN)

################# dependencies
invert_image.o: invert_image.cu
	$(NVCC) $(INCLUDES) -c invert_image.cu -o invert_image.o $(NVCCFLAGS_INVERT_IMAGE)

invert_image_CPU.o: invert_image_CPU.cpp
	$(CPP) $(CPPFLAGS) invert_image_CPU.cpp -o invert_image_CPU.o

lib.o:
	cd $(LIBDIR); make all;

################# clean
clean:
	rm *.o main